(this["webpackJsonpspeedrun-pb-graph"]=this["webpackJsonpspeedrun-pb-graph"]||[]).push([[0],{225:function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r),c=a(36),s=a.n(c),o=a(13),u=a(6),i=a(10),l=a.n(i),d=a(9),j=a(7),b=a(18),m=a(12),g=a.n(m),h=a(104),p=(a(217),a(15)),f=a(227),x=a(73),O=a(2),v=function(e){var t=e.error;return Object(O.jsxs)(x.a,{variant:"danger",children:["An error occured: ",t]})},y=function(){return Object(O.jsx)(x.a,{variant:"info",children:"Loading..."})},N=function(e){var t=e%1,a=Math.floor(e)%60,r=Math.floor(e/60)%60,n=Math.floor(e/3600),c=0===t?"":t.toFixed(3).slice(1),s=a<10?"0".concat(a):"".concat(a),o=r<10?"0".concat(r):"".concat(r),u=0===n?"":"".concat(n,":");return"".concat(u).concat(o,":").concat(s).concat(c)},I=function(){var e=Object(b.a)(l.a.mark((function e(t,a,r,n,c,s,o,u,i){var m,h,f,x,O,v,y,N,I,w,k,S,M;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t){e.next=3;break}throw new Error("No user id provided");case 3:if(a){e.next=5;break}throw new Error("No user id provided");case 5:return m={gameName:"",categoryName:"",levelName:"",subcategoryString:"",username:"",runs:[]},e.next=8,Promise.all([g()("".concat(H,"/categories/").concat(a,"?embed=game"),{timeout:3e4}),g()("".concat(H,"/users/").concat(t),{timeout:3e4}),r?g()("".concat(H,"/runs?user=").concat(t,"&level=").concat(n,"&category=").concat(a,"&max=200"),{timeout:3e4}):g()("".concat(H,"/runs?user=").concat(t,"&category=").concat(a,"&max=200"),{timeout:3e4})]);case 8:return h=e.sent,f=Object(j.a)(h,3),x=f[0],O=f[1],v=f[2],e.next=15,Promise.all([x.json(),O.json(),v.json()]);case 15:return y=e.sent,N=Object(j.a)(y,3),I=N[0],w=N[1],k=N[2],m.gameName=I.data.game.data.names.international,m.categoryName=I.data.name,e.next=24,Promise.all(Object(d.a)(c.entries()).map(function(){var e=Object(b.a)(l.a.mark((function e(t){var a,r,n,c,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Object(j.a)(t,2),r=a[0],n=a[1],e.next=3,g()("".concat(H,"/variables/").concat(r));case 3:return c=e.sent,e.next=6,c.json();case 6:return s=e.sent,e.abrupt("return",s.data.values.values[n].label);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 24:if(m.subcategoryString=e.sent.join(", "),!r){e.next=33;break}return e.next=28,g()("".concat(H,"/levels/").concat(n));case 28:return S=e.sent,e.next=31,S.json();case 31:M=e.sent,m.levelName=M.data.name;case 33:m.username=w.data.names.international,m.runs=k.data.filter((function(e){return"rejected"!==e.status.status})).filter((function(e){return Object.entries(e.values).every((function(e){var t=Object(j.a)(e,2),a=t[0];return t[1]===c.get(a)}))})).map((function(e){return{date:p.DateTime.fromFormat(e.date,"yyyy-MM-dd",{zone:"UTC"}),time:e.times.primary_t,id:e.id}})).sort((function(e,t){return e.date===t.date?e.time<t.time?-1:1:e.date<t.date?-1:1})),i(m),s(!1),e.next=44;break;case 39:e.prev=39,e.t0=e.catch(0),o(!0),u(e.t0.message),console.error(e.t0);case 44:case"end":return e.stop()}}),e,null,[[0,39]])})));return function(t,a,r,n,c,s,o,u,i){return e.apply(this,arguments)}}(),w=function(e){var t=e.isIL,a=Object(u.h)(),n=a.userId,c=a.categoryId,s=a.levelId,i=Object(r.useRef)(null),l=new URLSearchParams(Object(u.g)().search),d=Object(r.useState)(!0),b=Object(j.a)(d,2),m=b[0],g=b[1],p=Object(r.useState)(!1),x=Object(j.a)(p,2),w=x[0],k=x[1],S=Object(r.useState)(""),M=Object(j.a)(S,2),C=M[0],V=M[1],P=Object(r.useState)(),F=Object(j.a)(P,2),D=F[0],E=F[1];if(Object(r.useEffect)((function(){I(n,c,t,s,l,g,k,V,E)}),[]),w)return Object(O.jsx)(v,{error:C});if(m)return Object(O.jsx)(y,{});var L={labels:null===D||void 0===D?void 0:D.runs.map((function(e){return e.date})),datasets:[{label:"Time",data:null===D||void 0===D?void 0:D.runs.map((function(e){return e.time})),borderColor:"rgb(255,0,0)"}]},B={onClick:function(){if(i.current){var e=i.current.getActiveElements();if(e.length>0){var t=null===D||void 0===D?void 0:D.runs[e[0].index];window.location.href="https://speedrun.com/run/".concat(null===t||void 0===t?void 0:t.id)}}},responsive:!0,scales:{x:{type:"time",time:{tooltipFormat:"MMM d, yyyy"}},y:{ticks:{callback:function(e){return N(e)}}}},plugins:{tooltip:{callbacks:{label:function(e){return N(e.parsed.y)}}}}};return Object(O.jsxs)(O.Fragment,{children:[Object(O.jsxs)("h1",{children:[null===D||void 0===D?void 0:D.gameName," : ",t?(null===D||void 0===D?void 0:D.levelName)+" ":""," ",null===D||void 0===D?void 0:D.categoryName," - ",(null===D||void 0===D?void 0:D.subcategoryString)?D.subcategoryString+" - ":"",null===D||void 0===D?void 0:D.username]}),Object(O.jsx)(o.b,{to:"/user/".concat(n),children:"Back to user"}),Object(O.jsx)("p",{children:Object(O.jsx)("b",{children:" Click a data-point to see the associated run's speedrun.com page!"})}),Object(O.jsx)(f.a,{children:Object(O.jsx)(h.a,{ref:i,type:"line",data:L,options:B})})]})},k=a(228),S=a(101),M=a(72),C=a(100),V=function(){var e=Object(r.useState)(""),t=Object(j.a)(e,2),a=t[0],n=t[1],c=Object(u.f)();return Object(O.jsx)(M.a,{inline:!0,onSubmit:function(e){e.preventDefault(),c.push("/search/".concat(a))},children:Object(O.jsxs)(C.a,{children:[Object(O.jsx)(M.a.Control,{type:"search",name:"username",id:"searchInput",placeholder:"speedrun.com username",value:a,onChange:function(e){e.preventDefault(),n(e.target.value)}}),Object(O.jsx)(S.a,{type:"submit",children:Object(O.jsx)(k.a,{})})]})})},P=function(){return Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)("h1",{children:" Welcome to the Speedrun PB Grapher"}),Object(O.jsx)("h3",{children:" Enter your username to get started!"}),Object(O.jsx)(V,{})]})},F=a(102),D=function(e){var t=e.category,a=e.userID,r=t.subcategories.map((function(e){return"".concat(e.subcategoryKeyId,"=").concat(e.subcategoryValueId)})).join("&"),n=t.subcategories.map((function(e){return e.subcategoryValueName})).join(", ");return Object(O.jsx)("li",{children:Object(O.jsxs)(o.b,{to:"/graph/".concat(a,"/").concat(t.categoryId,"?").concat(r),children:[t.categoryName," ",t.subcategories.length>0?"- ".concat(n):""]})})},E=function(e){var t=e.category,a=e.userID,r=t.subcategories.map((function(e){return"".concat(e.subcategoryKeyId,"=").concat(e.subcategoryValueId)})).join("&"),n=t.subcategories.map((function(e){return e.subcategoryValueName})).join(", ");return Object(O.jsx)("li",{children:Object(O.jsxs)(o.b,{to:"/graph/il/".concat(a,"/").concat(t.levelId,"/").concat(t.categoryId,"?").concat(r),children:[t.levelName," ",t.categoryName," ",t.subcategories.length>0?"- ".concat(n):""]})})},L=function(e){var t=e.game,a=e.userData;return Object(O.jsxs)(O.Fragment,{children:[Object(O.jsxs)("h1",{children:[" ",t.name," "]}),t.fullGameCategories.length>0?Object(O.jsx)("h2",{children:"Full game runs:"}):Object(O.jsx)(O.Fragment,{}),Object(O.jsx)("ul",{children:t.fullGameCategories.map((function(e){return Object(O.jsx)(D,{category:e,userID:a.id},JSON.stringify(e))}))}),t.levelCategories.length>0?Object(O.jsx)("h2",{children:"IL runs:"}):Object(O.jsx)(O.Fragment,{}),Object(O.jsx)("ul",{children:t.levelCategories.map((function(e){return Object(O.jsx)(E,{category:e,userID:a.id},JSON.stringify(e))}))})]})},B=function(){var e=Object(b.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(Object.entries(t).map(function(){var e=Object(b.a)(l.a.mark((function e(t){var a,r,n,c,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Object(j.a)(t,2),r=a[0],n=a[1],e.next=3,g()("".concat(H,"/variables/").concat(r));case 3:return c=e.sent,e.next=6,c.json();case 6:return s=e.sent,e.abrupt("return",{subcategoryKeyId:r,subcategoryValueId:n,subcategoryValueName:s.data.values.values[n].label});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),G=function(){var e=Object(b.a)(l.a.mark((function e(t,a,r,n,c){var s,o,u,i,m,h,p,f,x,O,v,y,N,I,w,k,S;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Promise.all([g()("".concat(H,"/users/").concat(t),{timeout:3e4}),g()("".concat(H,"/users/").concat(t,"/personal-bests?embed=game,category,level"),{timeout:3e4})]);case 3:return u=e.sent,i=Object(j.a)(u,2),m=i[0],h=i[1],e.next=9,Promise.all([m.json(),h.json()]);case 9:return p=e.sent,f=Object(j.a)(p,2),x=f[0],O=f[1],v=Object(F.groupBy)(O.data,(function(e){return e.category.data.type})),y=null!==(s=v["per-game"])&&void 0!==s?s:[],N=null!==(o=v["per-level"])&&void 0!==o?o:[],e.next=18,Promise.all(y.map(function(){var e=Object(b.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=t.game.data.names.international,e.t1=t.game.data.id,e.t2=t.category.data.name,e.t3=t.category.data.id,e.next=6,B(t.run.values);case 6:return e.t4=e.sent,e.abrupt("return",{gameName:e.t0,gameId:e.t1,categoryName:e.t2,categoryId:e.t3,subcategories:e.t4});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 18:return I=e.sent.sort((function(e,t){return e.categoryName<t.categoryName?-1:e.categoryName>t.categoryName?1:0==e.subcategories.length?0:e.subcategories[0].subcategoryValueName<t.subcategories[0].subcategoryValueName?-1:e.subcategories[0].subcategoryValueName>t.subcategories[0].subcategoryValueName?1:0})),e.next=21,Promise.all(N.map(function(){var e=Object(b.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=t.game.data.names.international,e.t1=t.game.data.id,e.t2=t.category.data.name,e.t3=t.category.data.id,e.t4=t.level.data.id,e.t5=t.level.data.name,e.next=8,B(t.run.values);case 8:return e.t6=e.sent,e.abrupt("return",{gameName:e.t0,gameId:e.t1,categoryName:e.t2,categoryId:e.t3,levelId:e.t4,levelName:e.t5,subcategories:e.t6});case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 21:w=e.sent.sort((function(e,t){return e.levelName<t.levelName?-1:e.levelName>t.levelName?1:e.categoryName<t.categoryName?-1:e.categoryName>t.categoryName?1:0==e.subcategories.length?0:e.subcategories[0].subcategoryValueName<t.subcategories[0].subcategoryValueName?-1:e.subcategories[0].subcategoryValueName>t.subcategories[0].subcategoryValueName?1:0})),k=Object(d.a)(new Set(O.data.map((function(e){return e.game.data.id})))),S=k.map((function(e){var t=I.filter((function(t){return t.gameId===e})),a=w.filter((function(t){return t.gameId===e}));return{id:e,name:t.length>0?t[0].gameName:a[0].gameName,fullGameCategories:t,levelCategories:a}})),c({id:x.data.id,name:x.data.names.international,games:S}),a(!1),e.next=33;break;case 28:e.prev=28,e.t0=e.catch(0),r(!0),n(e.t0.message),console.error(e.t0);case 33:case"end":return e.stop()}}),e,null,[[0,28]])})));return function(t,a,r,n,c){return e.apply(this,arguments)}}(),J=function(){var e,t=Object(u.h)().id,a=Object(r.useState)(null),n=Object(j.a)(a,2),c=n[0],s=n[1],o=Object(r.useState)(!0),i=Object(j.a)(o,2),l=i[0],d=i[1],b=Object(r.useState)(!1),m=Object(j.a)(b,2),g=m[0],h=m[1],p=Object(r.useState)(""),f=Object(j.a)(p,2),x=f[0],N=f[1];return Object(r.useEffect)((function(){G(t,d,h,N,s)}),[]),g?Object(O.jsx)(v,{error:x}):l?Object(O.jsx)(y,{}):Object(O.jsxs)(O.Fragment,{children:[Object(O.jsxs)("h2",{children:["Categories for ",null===c||void 0===c?void 0:c.name]}),c&&(null===c||void 0===c||null===(e=c.games)||void 0===e?void 0:e.length)>0?null===c||void 0===c?void 0:c.games.map((function(e){return Object(O.jsx)(L,{game:e,userData:c},e.id)})):Object(O.jsx)("p",{children:"This user hasn't submitted any runs"})]})},R=a(103),T=a(231),A=a(230),K=(a(224),function(){var e=Object(b.a)(l.a.mark((function e(t,a,r,n,c,s){var o,u,i,d,j;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n(!0),o={exactMatch:null,results:[],hasNext:!1},e.prev=2,e.next=5,g()("".concat(H,"/users?lookup=").concat(t),{timeout:3e4});case 5:return u=e.sent,e.next=8,u.json();case 8:return(i=e.sent).data.length>0&&(o.exactMatch={id:i.data[0].id,name:i.data[0].names.international}),e.next=12,g()("".concat(H,"/users?name=").concat(t,"&offset=").concat(a),{timeout:3e4});case 12:return d=e.sent,e.next=15,d.json();case 15:j=e.sent,o.results=j.data.map((function(e){return{id:e.id,name:e.names.international}})),o.hasNext=void 0!==j.pagination.links.find((function(e){return"next"==e.rel})),r(o),n(!1),e.next=27;break;case 22:e.prev=22,e.t0=e.catch(2),console.error(e.t0),c(!0),s("Error ".concat(e.t0.message," occurred"));case 27:case"end":return e.stop()}}),e,null,[[2,22]])})));return function(t,a,r,n,c,s){return e.apply(this,arguments)}}()),U=function(){var e=Object(r.useState)(null),t=Object(j.a)(e,2),a=t[0],n=t[1],c=Object(r.useState)(!0),s=Object(j.a)(c,2),i=s[0],l=s[1],d=Object(r.useState)(!1),b=Object(j.a)(d,2),m=b[0],g=b[1],h=Object(r.useState)(""),p=Object(j.a)(h,2),f=p[0],x=p[1],N=Object(u.h)().query,I=Object(u.g)(),w=new URLSearchParams(I.search).get("offset"),k=w?parseInt(w):0;return Object(r.useEffect)((function(){K(N,k,n,l,g,x)}),[N,I]),m?Object(O.jsx)(v,{error:f}):i?Object(O.jsx)(y,{}):Object(O.jsxs)(O.Fragment,{children:[Object(O.jsxs)("h3",{children:["Results for ",N,":"]}),Object(O.jsxs)("ul",{children:[(null===a||void 0===a?void 0:a.exactMatch)&&Object(O.jsx)("p",{children:Object(O.jsxs)("b",{children:["An exact match was found: ",Object(O.jsxs)(o.b,{to:"/user/".concat(a.exactMatch.id),children:[a.exactMatch.name," "]})]})}),(null===a||void 0===a?void 0:a.results)&&a.results.length>0?a.results.map((function(e){var t=e.id,a=e.name;return Object(O.jsx)("li",{children:Object(O.jsxs)(o.b,{to:"/user/".concat(t),children:[a," "]})},t)})):Object(O.jsxs)("p",{children:["No users found. ",Object(O.jsx)(o.b,{to:"/",children:"Search again?"})]})]}),k>0&&Object(O.jsx)(o.b,{to:"/search/".concat(N,"?offset=").concat(Math.max(0,k-20)),children:"<Prev"}),k>0&&(null===a||void 0===a?void 0:a.hasNext)&&" - ",(null===a||void 0===a?void 0:a.hasNext)&&Object(O.jsx)(o.b,{to:"/search/".concat(N,"?offset=").concat(k+20),children:"Next >"})]})},q=a(229),H="https://speedrun.com/api/v1",z=function(){return Object(O.jsxs)(o.a,{children:[Object(O.jsxs)(T.a,{bg:"dark",expand:"lg",className:"mb-4",style:{justifyContent:"space-between"},children:[Object(O.jsxs)(A.a,{children:[Object(O.jsx)(T.a.Brand,{href:"#/",style:{color:"white"},children:"Speedrun PB Grapher"}),Object(O.jsx)(A.a.Link,{href:"#/",style:{color:"white"},children:"Home"})]}),Object(O.jsxs)(A.a,{className:"float-right",children:[Object(O.jsx)(V,{}),Object(O.jsx)(A.a.Link,{href:"https://github.com/Hurricane996/speedrun-pb-graph",children:Object(O.jsx)(q.a,{style:{color:"white"},className:"ml-auto"})})]})]}),Object(O.jsx)(R.a,{children:Object(O.jsxs)(u.c,{children:[Object(O.jsx)(u.a,{path:"/user/:id",exact:!0,children:Object(O.jsx)(J,{})}),Object(O.jsx)(u.a,{path:"/graph/il/:userId/:levelId/:categoryId",exact:!0,children:Object(O.jsx)(w,{isIL:!0})}),Object(O.jsx)(u.a,{path:"/graph/:userId/:categoryId",exact:!0,children:Object(O.jsx)(w,{isIL:!1})}),Object(O.jsx)(u.a,{path:"/search/:query",exact:!0,children:Object(O.jsx)(U,{})}),Object(O.jsx)(u.a,{path:"/",exact:!0,children:Object(O.jsx)(P,{})}),Object(O.jsx)(u.a,{children:"404"})]})})]})};s.a.render(Object(O.jsx)(n.a.StrictMode,{children:Object(O.jsx)(z,{})}),document.getElementById("root"))}},[[225,1,2]]]);
//# sourceMappingURL=main.3072c160.chunk.js.map