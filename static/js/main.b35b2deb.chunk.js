(this["webpackJsonpspeedrun-pb-graph"]=this["webpackJsonpspeedrun-pb-graph"]||[]).push([[0],{226:function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r),c=a(38),s=a.n(c),o=a(23),u=a(6),i=a(12),j=a.n(i),b=a(9),l=a(24),d=a(7),O=a(17),m=a.n(O),h=a(105),p=(a(218),a(14)),f=a(228),x=a(74),g=a(2),v=function(e){var t=e.error;return Object(g.jsxs)(x.a,{variant:"danger",children:["An error occured: ",t]})},y=function(){return Object(g.jsx)(x.a,{variant:"info",children:"Loading..."})},S=function(e){var t=e%1,a=Math.floor(e)%60,r=Math.floor(e/60)%60,n=Math.floor(e/3600),c=0===t?"":t.toFixed(3).slice(1),s=a<10?"0".concat(a):"".concat(a),o=r<10?"0".concat(r):"".concat(r),u=0===n?"":"".concat(n,":");return"".concat(u).concat(o,":").concat(s).concat(c)},k=function(){var e=Object(u.h)(),t=e.userId,a=e.categoryId,n=Object(r.useRef)(null),c=new URLSearchParams(Object(u.g)().search),s=Object(r.useState)(!0),i=Object(d.a)(s,2),O=i[0],x=i[1],k=Object(r.useState)(!1),w=Object(d.a)(k,2),I=w[0],N=w[1],P=Object(r.useState)(""),C=Object(d.a)(P,2),E=C[0],M=C[1],F=Object(r.useState)(""),D=Object(d.a)(F,2),B=D[0],L=D[1],V=Object(r.useState)(""),R=Object(d.a)(V,2),T=R[0],q=R[1],G=Object(r.useState)(""),H=Object(d.a)(G,2),J=H[0],K=H[1],U=Object(r.useState)(""),z=Object(d.a)(U,2),W=z[0],_=z[1],Q=Object(r.useState)([]),X=Object(d.a)(Q,2),Y=X[0],Z=X[1],$=function(){var e=Object(l.a)(j.a.mark((function e(){var r,n,s,o,u,i,O;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Promise.all([m()("".concat(A,"/categories/").concat(a,"?embed=game"),{timeout:3e4}),m()("".concat(A,"/users/").concat(t),{timeout:3e4}),m()("".concat(A,"/runs?user=").concat(t,"&category=").concat(a,"&max=200"),{timeout:3e4})]);case 3:return r=e.sent,e.next=6,Promise.all(r.map((function(e){return e.json()})));case 6:return n=e.sent,s=Object(d.a)(n,3),o=s[0],u=s[1],i=s[2],e.next=13,Promise.all(Object(b.a)(c.entries()).map(function(){var e=Object(l.a)(j.a.mark((function e(t){var a,r,n,c,s;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Object(d.a)(t,2),r=a[0],n=a[1],e.next=3,m()("".concat(A,"/variables/").concat(r));case 3:return c=e.sent,e.next=6,c.json();case 6:return s=e.sent,e.abrupt("return",s.data.values.values[n].label);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 13:O=e.sent.join(", "),L(o.data.game.data.names.international),q(o.data.name),_(O),K(u.data.names.international),x(!1),Z(i.data.filter((function(e){return"rejected"!==e.status.status})).filter((function(e){return Object.entries(e.values).every((function(e){var t=Object(d.a)(e,2),a=t[0];return t[1]===c.get(a)}))})).map((function(e){return{date:p.DateTime.fromFormat(e.date,"yyyy-MM-dd",{zone:"UTC"}),time:e.times.primary_t,id:e.id}})).sort((function(e,t){return e.date===t.date?e.time<t.time?-1:1:e.date<t.date?-1:1}))),e.next=27;break;case 22:e.prev=22,e.t0=e.catch(0),N(!0),M(e.t0.message),console.error(e.t0);case 27:case"end":return e.stop()}}),e,null,[[0,22]])})));return function(){return e.apply(this,arguments)}}();if(Object(r.useEffect)((function(){$()}),[]),I)return Object(g.jsx)(v,{error:E});if(O)return Object(g.jsx)(y,{});var ee={labels:Y.map((function(e){return e.date})),datasets:[{label:"Time",data:Y.map((function(e){return e.time})),borderColor:"rgb(255,0,0)"}]},te={onClick:function(){var e=n.current.getActiveElements();if(e.length>0){var t=Y[e[0].index];window.location.href="https://speedrun.com/run/".concat(t.id)}},responsive:!0,scales:{x:{type:"time",time:{tooltipFormat:"MMM d, yyyy"}},y:{ticks:{callback:function(e){return S(e)}}}},plugins:{tooltip:{callbacks:{label:function(e){return S(e.parsed.y)}}}}};return Object(g.jsxs)(g.Fragment,{children:[Object(g.jsxs)("h1",{children:[B," : ",T," - ",W?W+" - ":"",J]}),Object(g.jsx)(o.b,{to:"/user/".concat(t),children:"Back to user"}),Object(g.jsx)("p",{children:Object(g.jsx)("b",{children:" Click a data-point to see the associated run's speedrun.com page!"})}),Object(g.jsx)(f.a,{children:Object(g.jsx)(h.a,{ref:n,type:"line",data:ee,options:te})})]})},w=a(229),I=a(103),N=a(73),P=a(102),C=function(){var e=Object(r.useState)(""),t=Object(d.a)(e,2),a=t[0],n=t[1],c=Object(u.f)();return Object(g.jsx)(N.a,{inline:!0,onSubmit:function(e){e.preventDefault(),c.push("/search/".concat(a))},children:Object(g.jsxs)(P.a,{children:[Object(g.jsx)(N.a.Control,{type:"search",name:"username",id:"searchInput",placeholder:"speedrun.com username",value:a,onChange:function(e){e.preventDefault(),n(e.target.value)}}),Object(g.jsx)(I.a,{type:"submit",children:Object(g.jsx)(w.a,{})})]})})},E=function(){return Object(g.jsxs)(g.Fragment,{children:[Object(g.jsx)("h1",{children:" Welcome to the Speedrun PB Grapher"}),Object(g.jsx)("h3",{children:" Enter your username to get started!"}),Object(g.jsx)(C,{})]})},M=a(27),F=function(e){var t=e.category,a=e.userData,r=t.subcategories.map((function(e){return"".concat(e.subcategoryKeyId,"=").concat(e.subcategoryValueId)})).join("&"),n=t.subcategories.map((function(e){return e.subcategoryValueName})).join(", ");return Object(g.jsx)("li",{children:Object(g.jsxs)(o.b,{to:"/graph/".concat(null===a||void 0===a?void 0:a.id,"/").concat(t.categoryId,"?").concat(r),children:[t.categoryName," ",t.subcategories.length>0?"- ".concat(n):""]})},t.categoryId)},D=function(e){var t=e.game,a=e.userData;return Object(g.jsxs)(g.Fragment,{children:[Object(g.jsxs)("h3",{children:[" ",t.name," "]}),t.categories.map((function(e){return Object(g.jsx)(F,{category:e,userData:a},e.categoryId)}))]})},B=function(){var e=Object(u.h)().id,t=Object(r.useState)(!0),a=Object(d.a)(t,2),n=a[0],c=a[1],s=Object(r.useState)(!1),o=Object(d.a)(s,2),i=o[0],b=o[1],O=Object(r.useState)(""),h=Object(d.a)(O,2),p=h[0],f=h[1],x=Object(r.useState)(null),S=Object(d.a)(x,2),k=S[0],w=S[1],I=function(){var t=Object(l.a)(j.a.mark((function t(){var a,r,n,s,o,u,i;return j.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Promise.all([m()("".concat(A,"/users/").concat(e),{timeout:3e4}),m()("".concat(A,"/users/").concat(e,"/personal-bests?embed=game,category"),{timeout:3e4})]);case 3:return a=t.sent,t.next=6,Promise.all(a.map((function(e){return e.json()})));case 6:return r=t.sent,n=Object(d.a)(r,2),s=n[0],o=n[1],t.next=12,Promise.all(o.data.map(function(){var e=Object(l.a)(j.a.mark((function e(t){var a;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("per-level"!==t.category.data.type){e.next=2;break}return e.abrupt("return",null);case 2:return a={gameName:t.game.data.names.international,gameId:t.game.data.id,categoryName:t.category.data.name,categoryId:t.category.data.id,subcategories:[]},e.next=5,Promise.all(Object.entries(t.run.values).map(function(){var e=Object(l.a)(j.a.mark((function e(t){var r,n,c,s,o;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Object(d.a)(t,2),n=r[0],c=r[1],e.next=3,m()("".concat(A,"/variables/").concat(n));case 3:return s=e.sent,e.next=6,s.json();case 6:o=e.sent,a.subcategories.push({subcategoryKeyId:n,subcategoryValueId:c,subcategoryValueName:o.data.values.values[c].label});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 5:return e.abrupt("return",a);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 12:u=t.sent,i=[],u.forEach((function(e){if(null!==e){var t=!1;i.forEach((function(a){a.id===e.gameId&&(a.categories.push(e),t=!0)})),t||i.push({id:e.gameId,name:e.gameName,categories:[e]})}})),i.map((function(e){return Object(M.a)(Object(M.a)({},e),{},{categories:e.categories.sort((function(e,t){return e.categoryName.localeCompare(t.categoryName)}))})})),c(!1),w({id:s.data.id,name:s.data.names.international,games:i}),t.next=25;break;case 20:t.prev=20,t.t0=t.catch(0),b(!0),f(t.t0.message),console.error(t.t0);case 25:case"end":return t.stop()}}),t,null,[[0,20]])})));return function(){return t.apply(this,arguments)}}();return Object(r.useEffect)((function(){I()}),[]),i?Object(g.jsx)(v,{error:p}):n?Object(g.jsx)(y,{}):Object(g.jsxs)(g.Fragment,{children:[Object(g.jsxs)("h2",{children:["Categories for ",null===k||void 0===k?void 0:k.name]}),null===k||void 0===k?void 0:k.games.map((function(e){return Object(g.jsx)(D,{game:e,userData:k},e.id)}))]})},L=a(104),V=a(232),R=a(231),T=(a(225),function(){var e=Object(r.useState)([]),t=Object(d.a)(e,2),a=t[0],n=t[1],c=Object(u.h)().query,s=Object(r.useState)(!1),i=Object(d.a)(s,2),b=i[0],O=i[1],h=Object(r.useState)(""),p=Object(d.a)(h,2),f=p[0],x=p[1],S=Object(r.useState)(!0),k=Object(d.a)(S,2),w=k[0],I=k[1],N=function(){var e=Object(l.a)(j.a.mark((function e(){var t,a;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return I(!0),e.prev=1,e.next=4,m()("".concat(A,"/users?name=").concat(c),{timeout:3e4});case 4:return t=e.sent,e.next=7,t.json();case 7:a=e.sent,n(a.data.map((function(e){return{id:e.id,name:e.names.international}}))),I(!1),e.next=17;break;case 12:e.prev=12,e.t0=e.catch(1),console.error(e.t0),O(!0),x("Error ".concat(f," occurred"));case 17:case"end":return e.stop()}}),e,null,[[1,12]])})));return function(){return e.apply(this,arguments)}}();return Object(r.useEffect)((function(){N()}),[c]),b?Object(g.jsx)(v,{error:f}):w?Object(g.jsx)(y,{}):Object(g.jsxs)(g.Fragment,{children:[Object(g.jsxs)("h3",{children:["Results for ",c,":"]}),Object(g.jsx)("ul",{children:a.length>0?a.map((function(e){var t=e.id,a=e.name;return Object(g.jsx)("li",{children:Object(g.jsxs)(o.b,{to:"/user/".concat(t),children:[a," "]})},t)})):Object(g.jsxs)("p",{children:["No users found. ",Object(g.jsx)(o.b,{to:"/",children:"Search again?"})]})})]})}),q=a(230),A="https://speedrun.com/api/v1",G=function(){return Object(g.jsxs)(o.a,{children:[Object(g.jsxs)(V.a,{bg:"dark",expand:"lg",className:"mb-4",style:{justifyContent:"space-between"},children:[Object(g.jsxs)(R.a,{children:[Object(g.jsx)(V.a.Brand,{href:"#/",style:{color:"white"},children:"Speedrun PB Grapher"}),Object(g.jsx)(R.a.Link,{href:"#/",style:{color:"white"},children:"Home"})]}),Object(g.jsxs)(R.a,{className:"float-right",children:[Object(g.jsx)(C,{}),Object(g.jsx)(R.a.Link,{href:"https://github.com/Hurricane996/speedrun-pb-graph",children:Object(g.jsx)(q.a,{style:{color:"white"},className:"ml-auto"})})]})]}),Object(g.jsx)(L.a,{children:Object(g.jsxs)(u.c,{children:[Object(g.jsx)(u.a,{path:"/user/:id",exact:!0,children:Object(g.jsx)(B,{})}),Object(g.jsx)(u.a,{path:"/graph/:userId/:categoryId",exact:!0,children:Object(g.jsx)(k,{})}),Object(g.jsx)(u.a,{path:"/search/:query",exact:!0,children:Object(g.jsx)(T,{})}),Object(g.jsx)(u.a,{path:"/",exact:!0,children:Object(g.jsx)(E,{})}),Object(g.jsx)(u.a,{children:"404"})]})})]})};s.a.render(Object(g.jsx)(n.a.StrictMode,{children:Object(g.jsx)(G,{})}),document.getElementById("root"))}},[[226,1,2]]]);
//# sourceMappingURL=main.b35b2deb.chunk.js.map