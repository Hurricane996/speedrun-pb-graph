(this["webpackJsonpspeedrun-pb-graph"]=this["webpackJsonpspeedrun-pb-graph"]||[]).push([[0],{225:function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r),c=a(35),s=a.n(c),o=a(13),u=a(6),i=a(7),l=a.n(i),d=a(9),b=a(10),j=a(12),m=a(104),h=(a(217),a(15)),g=a(227),p=a(72),f=a(2),v=function(e){var t=e.error;return Object(f.jsxs)(p.a,{variant:"danger",children:["An error occured: ",t]})},x=function(){return Object(f.jsx)(p.a,{variant:"info",children:"Loading..."})},O=function(e){var t=e%1,a=Math.floor(e)%60,r=Math.floor(e/60)%60,n=Math.floor(e/3600),c=0===t?"":t.toFixed(3).slice(1),s=a<10?"0".concat(a):"".concat(a),o=r<10?"0".concat(r):"".concat(r),u=0===n?"":"".concat(n,":");return"".concat(u).concat(o,":").concat(s).concat(c)},y=function(e,t,a){var n=Object(r.useState)(null),c=Object(b.a)(n,2),s=c[0],o=c[1],u=Object(r.useState)(!0),i=Object(b.a)(u,2),d=i[0],m=i[1],h=Object(r.useState)(null),g=Object(b.a)(h,2),p=g[0],f=g[1];return Object(r.useEffect)((function(){Object(j.a)(l.a.mark((function a(){var r;return l.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return m(!0),a.prev=1,a.next=4,e(t);case 4:r=a.sent,o(r),console.log("Data has been set"),m(!1),a.next=14;break;case 10:a.prev=10,a.t0=a.catch(1),console.error(a.t0),f(a.t0.message);case 14:case"end":return a.stop()}}),a,null,[[1,10]])})))()}),null!==a&&void 0!==a?a:[]),[s,d,p]},N=function(e,t,a){return a?e?t+e:"":e?e+t:""},w=a(98),I=a.n(w),k=function(){var e=Object(j.a)(l.a.mark((function e(t,a){var r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I()(t,a);case 2:return r=e.sent,e.abrupt("return",r.json());case 4:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),S=function(){var e=Object(j.a)(l.a.mark((function e(t){var a,r,n,c,s,o,u,i,m,g,p,f;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.userId,r=t.categoryId,n=t.levelId,c=t.searchParams,a){e.next=3;break}throw new Error("No user id provided!");case 3:if(r){e.next=5;break}throw new Error("No user id provided!");case 5:return e.next=7,Promise.all([k("".concat(z,"/categories/").concat(r,"?embed=game"),{timeout:3e4}),k("".concat(z,"/users/").concat(a),{timeout:3e4}),k("".concat(z,"/runs?user=").concat(a).concat(N(n,"&level=",!0),"&category=").concat(r,"&max=200"),{timeout:3e4}),n?k("".concat(z,"/levels/").concat(n),{timeout:3e4}):Promise.resolve(null),Promise.all(Object(d.a)(c.entries()).map(function(){var e=Object(j.a)(l.a.mark((function e(t){var a,r,n,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Object(b.a)(t,2),r=a[0],n=a[1],e.next=3,k("".concat(z,"/variables/").concat(r),{timeout:3e4});case 3:return c=e.sent,e.abrupt("return",c.data.values.values[n].label);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()))]);case 7:return s=e.sent,o=Object(b.a)(s,5),u=o[0],i=o[1],m=o[2],g=o[3],p=o[4],f=m.data.filter((function(e){return"rejected"!==e.status.status})).filter((function(e){return Object.entries(e.values).every((function(e){var t=Object(b.a)(e,2),a=t[0];return t[1]===c.get(a)}))})).map((function(e){return{date:h.DateTime.fromFormat(e.date,"yyyy-MM-dd",{zone:"UTC"}),time:e.times.primary_t,id:e.id}})).sort((function(e,t){return e.date===t.date?e.time<t.time?-1:1:e.date<t.date?-1:1})),e.abrupt("return",{gameName:u.data.game.data.names.international,categoryName:u.data.name,subcategoryString:p.join(", "),username:i.data.names.international,levelName:g?g.data.name:"",runs:f});case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),P=function(){var e=Object(u.h)(),t=e.userId,a=e.categoryId,n=e.levelId,c=Object(r.useRef)(null),s=new URLSearchParams(Object(u.g)().search),i=y(S,{userId:t,categoryId:a,levelId:n,searchParams:s}),l=Object(b.a)(i,3),d=l[0],j=l[1],h=l[2];if(h)return Object(f.jsx)(v,{error:h});if(j)return Object(f.jsx)(x,{});var p={labels:null===d||void 0===d?void 0:d.runs.map((function(e){return e.date})),datasets:[{label:"Time",data:null===d||void 0===d?void 0:d.runs.map((function(e){return e.time})),borderColor:"rgb(255,0,0)"}]},w={onClick:function(){if(c.current){var e=c.current.getActiveElements();if(e.length>0){var t=null===d||void 0===d?void 0:d.runs[e[0].index];window.location.href="https://speedrun.com/run/".concat(null===t||void 0===t?void 0:t.id)}}},responsive:!0,scales:{x:{type:"time",time:{tooltipFormat:"MMM d, yyyy"}},y:{ticks:{callback:function(e){return O(e)}}}},plugins:{tooltip:{callbacks:{label:function(e){return O(e.parsed.y)}}}}};return Object(f.jsxs)(f.Fragment,{children:[Object(f.jsxs)("h1",{children:[null===d||void 0===d?void 0:d.gameName,": ",N(null===d||void 0===d?void 0:d.levelName," "),null===d||void 0===d?void 0:d.categoryName," - ",N(null===d||void 0===d?void 0:d.subcategoryString," - "),null===d||void 0===d?void 0:d.username]}),Object(f.jsx)(o.b,{to:"/user/".concat(t),children:"Back to user"}),Object(f.jsx)("p",{children:Object(f.jsx)("b",{children:" Click a data-point to see the associated run's speedrun.com page!"})}),Object(f.jsx)(g.a,{children:Object(f.jsx)(m.a,{ref:c,type:"line",data:p,options:w})})]})},C=a(228),M=a(101),V=a(71),F=a(100),L=function(){var e=Object(r.useState)(""),t=Object(b.a)(e,2),a=t[0],n=t[1],c=Object(u.f)();return Object(f.jsx)(V.a,{inline:!0,onSubmit:function(e){e.preventDefault(),c.push("/search/".concat(a))},children:Object(f.jsxs)(F.a,{children:[Object(f.jsx)(V.a.Control,{type:"search",name:"username",id:"searchInput",placeholder:"speedrun.com username",value:a,onChange:function(e){e.preventDefault(),n(e.target.value)}}),Object(f.jsx)(M.a,{type:"submit",children:Object(f.jsx)(C.a,{})})]})})},B=function(){return Object(f.jsxs)(f.Fragment,{children:[Object(f.jsx)("h1",{children:" Welcome to the Speedrun PB Grapher"}),Object(f.jsx)("h3",{children:" Enter your username to get started!"}),Object(f.jsx)(L,{})]})},E=a(102),G=function(){var e=Object(j.a)(l.a.mark((function e(t){var a,r,n,c,s,o,u,i,m,h,g,p,f,v,x;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.id,c=function(){var e=Object(j.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(Object.entries(t).map(function(){var e=Object(j.a)(l.a.mark((function e(t){var a,r,n,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Object(b.a)(t,2),r=a[0],n=a[1],e.next=3,k("".concat(z,"/variables/").concat(r),{timeout:3e3});case 3:return c=e.sent,e.abrupt("return",{subcategoryKeyId:r,subcategoryValueId:n,subcategoryValueName:c.data.values.values[n].label});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.next=4,Promise.all([k("".concat(z,"/users/").concat(n),{timeout:3e4}),k("".concat(z,"/users/").concat(n,"/personal-bests?embed=game,category,level"),{timeout:3e4})]);case 4:return s=e.sent,o=Object(b.a)(s,2),u=o[0],i=o[1],m=Object(E.groupBy)(i.data,(function(e){return e.category.data.type})),h=null!==(a=m["per-game"])&&void 0!==a?a:[],g=null!==(r=m["per-level"])&&void 0!==r?r:[],e.next=13,Promise.all(h.map(function(){var e=Object(j.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=t.game.data.names.international,e.t1=t.game.data.id,e.t2=t.category.data.name,e.t3=t.category.data.id,e.next=6,c(t.run.values);case 6:return e.t4=e.sent,e.abrupt("return",{gameName:e.t0,gameId:e.t1,categoryName:e.t2,categoryId:e.t3,subcategories:e.t4});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 13:return p=e.sent.sort((function(e,t){return e.categoryName<t.categoryName?-1:e.categoryName>t.categoryName?1:0==e.subcategories.length?0:e.subcategories[0].subcategoryValueName<t.subcategories[0].subcategoryValueName?-1:e.subcategories[0].subcategoryValueName>t.subcategories[0].subcategoryValueName?1:0})),e.next=16,Promise.all(g.map(function(){var e=Object(j.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=t.game.data.names.international,e.t1=t.game.data.id,e.t2=t.category.data.name,e.t3=t.category.data.id,e.t4=t.level.data.id,e.t5=t.level.data.name,e.next=8,c(t.run.values);case 8:return e.t6=e.sent,e.abrupt("return",{gameName:e.t0,gameId:e.t1,categoryName:e.t2,categoryId:e.t3,levelId:e.t4,levelName:e.t5,subcategories:e.t6});case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 16:return f=e.sent.sort((function(e,t){return e.levelName<t.levelName?-1:e.levelName>t.levelName?1:e.categoryName<t.categoryName?-1:e.categoryName>t.categoryName?1:0==e.subcategories.length?0:e.subcategories[0].subcategoryValueName<t.subcategories[0].subcategoryValueName?-1:e.subcategories[0].subcategoryValueName>t.subcategories[0].subcategoryValueName?1:0})),v=Object(d.a)(new Set(i.data.map((function(e){return e.game.data.id})))),x=v.map((function(e){var t=p.filter((function(t){return t.gameId===e})),a=f.filter((function(t){return t.gameId===e}));return{id:e,name:t.length>0?t[0].gameName:a[0].gameName,fullGameCategories:t,levelCategories:a}})),e.abrupt("return",{id:u.data.id,name:u.data.names.international,games:x});case 20:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),R=function(e){return e.length?"?"+e.map((function(e){return"".concat(e.subcategoryKeyId,"=").concat(e.subcategoryValueId)})).join("&"):""},q=function(e){return e.length?" - "+e.map((function(e){return e.subcategoryValueName})).join(", "):""},D=function(){var e,t=Object(u.h)().id,a=y(G,{id:t}),r=Object(b.a)(a,3),c=r[0],s=r[1],i=r[2];return i?Object(f.jsx)(v,{error:i}):s?Object(f.jsx)(x,{}):Object(f.jsxs)(f.Fragment,{children:[Object(f.jsxs)("h1",{children:["Categories for ",null===c||void 0===c?void 0:c.name]}),c&&(null===c||void 0===c||null===(e=c.games)||void 0===e?void 0:e.length)>0?null===c||void 0===c?void 0:c.games.map((function(e){return Object(f.jsxs)(n.a.Fragment,{children:[Object(f.jsxs)("h2",{children:[" ",e.name," "]}),e.fullGameCategories.length>0?Object(f.jsx)("h3",{children:"Full game runs:"}):Object(f.jsx)(f.Fragment,{}),Object(f.jsx)("ul",{children:e.fullGameCategories.map((function(e){return Object(f.jsx)("li",{children:Object(f.jsxs)(o.b,{to:"/graph/".concat(c.id,"/").concat(e.categoryId).concat(R(e.subcategories)),children:[e.categoryName,q(e.subcategories)]})},JSON.stringify(e))}))}),e.levelCategories.length>0?Object(f.jsx)("h3",{children:"IL runs:"}):Object(f.jsx)(f.Fragment,{}),Object(f.jsx)("ul",{children:e.levelCategories.map((function(e){return Object(f.jsx)("li",{children:Object(f.jsxs)(o.b,{to:"/graph/il/".concat(c.id,"/").concat(e.levelId,"/").concat(e.categoryId,"?").concat(R(e.subcategories)),children:[e.levelName," ",e.categoryName,q(e.subcategories)]})},JSON.stringify(e))}))})]},e.id)})):Object(f.jsx)("p",{children:"This user hasn't submitted any runs"})]})},J=a(103),T=a(231),A=a(230),U=(a(224),function(){var e=Object(j.a)(l.a.mark((function e(t){var a,r,n,c,s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.query,r=t.offset,e.next=3,Promise.all([k("".concat(z,"/users?lookup=").concat(a),{timeout:3e4}),k("".concat(z,"/users?name=").concat(a,"&offset=").concat(r),{timeout:3e4})]);case 3:return n=e.sent,c=Object(b.a)(n,2),s=c[0],o=c[1],e.abrupt("return",{exactMatch:s.data.length>0?{id:s.data[0].id,name:s.data[0].names.international}:null,results:o.data.map((function(e){return{id:e.id,name:e.names.international}})),hasNext:void 0!==o.pagination.links.find((function(e){return"next"==e.rel}))});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),H=function(){var e=Object(u.h)().query,t=new URLSearchParams(Object(u.g)().search).get("offset"),a=t?parseInt(t):0,r=y(U,{query:e,offset:a},[e,a]),n=Object(b.a)(r,3),c=n[0],s=n[1],i=n[2];return i?Object(f.jsx)(v,{error:i}):s?Object(f.jsx)(x,{}):Object(f.jsxs)(f.Fragment,{children:[Object(f.jsxs)("h3",{children:["Results for ",e,":"]}),Object(f.jsxs)("ul",{children:[(null===c||void 0===c?void 0:c.exactMatch)&&Object(f.jsx)("p",{children:Object(f.jsxs)("b",{children:["An exact match was found: ",Object(f.jsxs)(o.b,{to:"/user/".concat(c.exactMatch.id),children:[c.exactMatch.name," "]})]})}),(null===c||void 0===c?void 0:c.results)&&c.results.length>0?c.results.map((function(e){var t=e.id,a=e.name;return Object(f.jsx)("li",{children:Object(f.jsxs)(o.b,{to:"/user/".concat(t),children:[a," "]})},t)})):Object(f.jsxs)("p",{children:["No users found. ",Object(f.jsx)(o.b,{to:"/",children:"Search again?"})]})]}),a>0&&Object(f.jsx)(o.b,{to:"/search/".concat(e,"?offset=").concat(Math.max(0,a-20)),children:"<Prev"}),a>0&&(null===c||void 0===c?void 0:c.hasNext)&&" - ",(null===c||void 0===c?void 0:c.hasNext)&&Object(f.jsx)(o.b,{to:"/search/".concat(e,"?offset=").concat(a+20),children:"Next >"})]})},K=a(229),z="https://speedrun.com/api/v1",W=function(){return Object(f.jsxs)(o.a,{children:[Object(f.jsxs)(T.a,{bg:"dark",expand:"lg",className:"mb-4",style:{justifyContent:"space-between",paddingLeft:"1em",paddingRight:"1em"},children:[Object(f.jsxs)(A.a,{children:[Object(f.jsx)(T.a.Brand,{href:"#/",style:{color:"white"},children:"Speedrun PB Grapher"}),Object(f.jsx)(A.a.Link,{href:"#/",style:{color:"white"},children:"Home"})]}),Object(f.jsxs)(A.a,{className:"float-right",children:[Object(f.jsx)(L,{}),Object(f.jsx)(A.a.Link,{href:"https://github.com/Hurricane996/speedrun-pb-graph",children:Object(f.jsx)(K.a,{style:{color:"white"},className:"ml-auto"})})]})]}),Object(f.jsx)(J.a,{children:Object(f.jsxs)(u.c,{children:[Object(f.jsx)(u.a,{path:"/user/:id",exact:!0,children:Object(f.jsx)(D,{})}),Object(f.jsx)(u.a,{path:"/graph/il/:userId/:levelId/:categoryId",exact:!0,children:Object(f.jsx)(P,{})}),Object(f.jsx)(u.a,{path:"/graph/:userId/:categoryId",exact:!0,children:Object(f.jsx)(P,{})}),Object(f.jsx)(u.a,{path:"/search/:query",exact:!0,children:Object(f.jsx)(H,{})}),Object(f.jsx)(u.a,{path:"/",exact:!0,children:Object(f.jsx)(B,{})}),Object(f.jsx)(u.a,{children:"404"})]})})]})};s.a.render(Object(f.jsx)(n.a.StrictMode,{children:Object(f.jsx)(W,{})}),document.getElementById("root"))}},[[225,1,2]]]);
//# sourceMappingURL=main.030f07a1.chunk.js.map